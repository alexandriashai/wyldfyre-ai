# Multi-Agent AI Infrastructure - Architecture Plan

## Overview

A self-hosted, installable AI infrastructure enabling multiple autonomous Claude agents to collaborate, learn, and manage server resources. Integrates Daniel Miessler's PAI (Personal AI Infrastructure) for self-improvement capabilities.

## Cost Constraints

| Category | Service | Cost |
|----------|---------|------|
| **Paid** | Claude API/Account | Per-usage |
| **Paid** | OpenAI API (Embeddings, Whisper STT, TTS) | Per-usage |
| **Paid** | AWS Secrets Manager | Per-usage (minimal) |
| **Paid** | Cloudflare API (Pro/Business) | Account subscription |
| **Free** | GitHub (with PAT) | Free |
| **Free** | Everything else | $0 |

### External Service Integrations

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL SERVICE INTEGRATIONS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   AWS SECRETS MGR   â”‚  â”‚    CLOUDFLARE API   â”‚  â”‚      GITHUB         â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                     â”‚  â”‚                     â”‚  â”‚                     â”‚
â”‚ â€¢ API keys storage  â”‚  â”‚ â€¢ DNS management    â”‚  â”‚ â€¢ Code backup       â”‚
â”‚ â€¢ DB credentials    â”‚  â”‚ â€¢ CDN caching       â”‚  â”‚ â€¢ Version control   â”‚
â”‚ â€¢ JWT secrets       â”‚  â”‚ â€¢ DDoS protection   â”‚  â”‚ â€¢ Config sync       â”‚
â”‚ â€¢ Rotation support  â”‚  â”‚ â€¢ SSL certificates  â”‚  â”‚ â€¢ Memory archival   â”‚
â”‚ â€¢ IAM integration   â”‚  â”‚ â€¢ Firewall rules    â”‚  â”‚ â€¢ Agent prompts     â”‚
â”‚                     â”‚  â”‚ â€¢ Analytics         â”‚  â”‚ â€¢ Collaboration     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                        â”‚                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   AI INFRASTRUCTURE       â”‚
                    â”‚   (Your Server)           â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        MULTI-AGENT AI INFRASTRUCTURE                            â”‚
â”‚                         with PAI Integration                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                                 INTERNET
                                     â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚     NGINX (TLS + Reverse      â”‚
                     â”‚        Proxy + Domains)       â”‚
                     â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
                     â”‚   â”‚ domain1.com â†’ /www1 â”‚     â”‚
                     â”‚   â”‚ domain2.com â†’ /www2 â”‚     â”‚
                     â”‚   â”‚ portal.ai   â†’ :3000 â”‚     â”‚
                     â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                           â”‚                           â”‚
         â–¼                           â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   WEB PORTAL    â”‚      â”‚    API GATEWAY      â”‚      â”‚  VOICE SERVICE  â”‚
â”‚   (Next.js)     â”‚      â”‚    (FastAPI)        â”‚      â”‚  (Whisper+TTS)  â”‚
â”‚   Port: 3000    â”‚      â”‚    Port: 8000       â”‚      â”‚  Port: 8001     â”‚
â”‚   [MIT]         â”‚      â”‚    [MIT]            â”‚      â”‚  [OpenAI API]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                         â”‚                           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚      REDIS MESSAGE BUS    â”‚
                     â”‚   Pub/Sub + Streams       â”‚
                     â”‚   Port: 6379 [BSD]        â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TMUX SESSION: ai-infrastructure                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚ SUPERVISOR  â”‚ â”‚ CODE AGENT  â”‚ â”‚ DATA AGENT  â”‚             â”‚  â”‚
â”‚  â”‚  â”‚   Window 0  â”‚ â”‚  Window 1   â”‚ â”‚  Window 2   â”‚             â”‚  â”‚
â”‚  â”‚  â”‚  (Claude)   â”‚ â”‚  (Claude)   â”‚ â”‚  (Claude)   â”‚  ...        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â”‚         â”‚               â”‚               â”‚                     â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â”‚                         â”‚                                     â”‚  â”‚
â”‚  â”‚              PAI INTEGRATION LAYER                            â”‚  â”‚
â”‚  â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚  â”‚
â”‚  â”‚         â”‚   THE ALGORITHM (7-Phase)     â”‚                     â”‚  â”‚
â”‚  â”‚         â”‚ OBSERVEâ†’THINKâ†’PLANâ†’BUILDâ†’     â”‚                     â”‚  â”‚
â”‚  â”‚         â”‚ EXECUTEâ†’VERIFYâ†’LEARN          â”‚                     â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â”‚  SSH ACCESS: ssh root@server â†’ tmux attach -t ai-infrastructure     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                         â”‚                             â”‚
         â–¼                         â–¼                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     QDRANT      â”‚    â”‚    POSTGRESQL       â”‚    â”‚    PAI MEMORY       â”‚
â”‚  Vector Store   â”‚    â”‚   Conversations     â”‚    â”‚   (File-based)      â”‚
â”‚  Port: 6333     â”‚    â”‚   Users, Tasks      â”‚    â”‚                     â”‚
â”‚  [Apache 2.0]   â”‚    â”‚   Port: 5432 [BSD]  â”‚    â”‚   MEMORY/           â”‚
â”‚                 â”‚    â”‚                     â”‚    â”‚   â”œâ”€â”€ Learning/     â”‚
â”‚  - Embeddings   â”‚    â”‚                     â”‚    â”‚   â”œâ”€â”€ Signals/      â”‚
â”‚  - RAG Memory   â”‚    â”‚                     â”‚    â”‚   â””â”€â”€ Work/         â”‚
â”‚  - Knowledge    â”‚    â”‚                     â”‚    â”‚                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           SERVER MANAGEMENT LAYER                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                                 â”‚
â”‚  DOMAIN MANAGEMENT          WEB ROOTS              SERVICES                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚ /etc/nginx/    â”‚        â”‚ /var/www/      â”‚     â”‚ systemd units  â”‚           â”‚
â”‚  â”‚   sites-avail/ â”‚        â”‚   domain1/     â”‚     â”‚ docker         â”‚           â”‚
â”‚  â”‚   sites-enable/â”‚        â”‚   domain2/     â”‚     â”‚ certbot        â”‚           â”‚
â”‚  â”‚   ssl/         â”‚        â”‚   portal/      â”‚     â”‚ fail2ban       â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              EXTERNAL APIs (Paid)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚    ANTHROPIC        â”‚              â”‚      OPENAI         â”‚                   â”‚
â”‚  â”‚    Claude API       â”‚              â”‚  - Embeddings       â”‚                   â”‚
â”‚  â”‚    (All Agents)     â”‚              â”‚  - Whisper (STT)    â”‚                   â”‚
â”‚  â”‚                     â”‚              â”‚  - TTS              â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Technology Stack (All Free/Open Source except APIs)

### Core Infrastructure

| Component | Technology | License | Purpose |
|-----------|------------|---------|---------|
| Message Bus | Redis | BSD-3 | Pub/Sub, Streams, Caching |
| Vector DB | Qdrant | Apache 2.0 | Embeddings, RAG, Knowledge |
| Relational DB | PostgreSQL | PostgreSQL License | Users, Tasks, Conversations |
| Reverse Proxy | Nginx | BSD-2 | TLS, Domains, Load Balancing |
| SSL Certs | Let's Encrypt + Certbot | Free | TLS Certificates |
| Containers | Docker + Compose | Apache 2.0 | Isolation, Deployment |

### Application Layer

| Component | Technology | License | Purpose |
|-----------|------------|---------|---------|
| API Server | FastAPI | MIT | REST + WebSocket API |
| Frontend | Next.js 14 | MIT | Web Portal |
| UI Components | shadcn/ui + Tailwind | MIT | Component Library |
| Tmux Control | libtmux | MIT | Agent Process Management |
| Session Manager | tmuxp | MIT | Tmux Configuration |

### AI Services (Paid)

| Service | Provider | Purpose |
|---------|----------|---------|
| Agent LLM | Claude API | All agent intelligence |
| Embeddings | OpenAI text-embedding-3-small | Vector embeddings |
| Speech-to-Text | OpenAI Whisper | Voice transcription |
| Text-to-Speech | OpenAI TTS | Voice synthesis |

### PAI Integration

| Component | Source | Purpose |
|-----------|--------|---------|
| The Algorithm | PAI | 7-phase improvement cycle |
| Memory System | PAI | Hot/Warm/Cold learning |
| Hook System | PAI | Event-driven automation |
| TELOS Config | PAI | Goal/value alignment |

---

## Agent Architecture

### Agent Types & Responsibilities

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           AGENT HIERARCHY                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   SUPERVISOR AGENT  â”‚
                        â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
                        â”‚   â€¢ Task routing    â”‚
                        â”‚   â€¢ Orchestration   â”‚
                        â”‚   â€¢ User interface  â”‚
                        â”‚   â€¢ Conflict res.   â”‚
                        â”‚   â€¢ PAI Algorithm   â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚              â”‚           â”‚           â”‚              â”‚
        â–¼              â–¼           â–¼           â–¼              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CODE AGENT  â”‚ â”‚  DATA AGENT  â”‚ â”‚ INFRA AGENT  â”‚ â”‚RESEARCH AGENTâ”‚ â”‚   QA AGENT   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚ â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ â€¢ Git ops    â”‚ â”‚ â€¢ SQL/DB     â”‚ â”‚ â€¢ Docker     â”‚ â”‚ â€¢ Web search â”‚ â”‚ â€¢ Testing    â”‚
â”‚ â€¢ Coding     â”‚ â”‚ â€¢ Analysis   â”‚ â”‚ â€¢ Nginx      â”‚ â”‚ â€¢ Docs       â”‚ â”‚ â€¢ Review     â”‚
â”‚ â€¢ Refactor   â”‚ â”‚ â€¢ ETL        â”‚ â”‚ â€¢ Domains    â”‚ â”‚ â€¢ Synthesis  â”‚ â”‚ â€¢ Security   â”‚
â”‚ â€¢ Debug      â”‚ â”‚ â€¢ Backups    â”‚ â”‚ â€¢ SSL/TLS    â”‚ â”‚ â€¢ Learning   â”‚ â”‚ â€¢ Validation â”‚
â”‚              â”‚ â”‚              â”‚ â”‚ â€¢ Monitoring â”‚ â”‚              â”‚ â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Agent Communication Protocol

```python
# Message Schema
{
    "id": "uuid",
    "timestamp": "ISO-8601",
    "source": "supervisor",
    "target": "code_agent",  # or "*" for broadcast
    "type": "task|result|handoff|query|heartbeat|learn",
    "priority": 1-10,
    "payload": {
        "task_id": "uuid",
        "action": "implement_feature",
        "context": {...},
        "memory_refs": ["qdrant_id_1", "qdrant_id_2"]
    },
    "pai": {
        "algorithm_phase": "EXECUTE",
        "verification_criteria": [...],
        "learning_signals": []
    }
}
```

### Inter-Agent Patterns

```
SEQUENTIAL:     Supervisor â†’ Agent A â†’ Agent B â†’ Supervisor
PARALLEL:       Supervisor â†’ [Agent A, Agent B, Agent C] â†’ Supervisor
PEER CONSULT:   Agent A â†â†’ Agent B (direct query/response)
BROADCAST:      Agent A â†’ Redis Pub/Sub â†’ All Agents (knowledge share)
HANDOFF:        Agent A â†’ Agent B (transfer ownership)
```

---

## PAI Integration

### The Algorithm (7-Phase Improvement Cycle)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         THE ALGORITHM                                       â”‚
â”‚                   (Continuous Improvement Engine)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ OBSERVE  â”‚â”€â”€â”€â”€â–¶â”‚  THINK   â”‚â”€â”€â”€â”€â–¶â”‚   PLAN   â”‚â”€â”€â”€â”€â–¶â”‚  BUILD   â”‚
    â”‚          â”‚     â”‚          â”‚     â”‚          â”‚     â”‚          â”‚
    â”‚ Gather   â”‚     â”‚ Generate â”‚     â”‚ Select   â”‚     â”‚ Define   â”‚
    â”‚ context  â”‚     â”‚ options  â”‚     â”‚ approach â”‚     â”‚ criteria â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                                                            â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ EXECUTE  â”‚â”€â”€â”€â”€â–¶â”‚  VERIFY  â”‚â”€â”€â”€â”€â–¶â”‚  LEARN   â”‚
    â”‚          â”‚     â”‚          â”‚     â”‚          â”‚
    â”‚ Perform  â”‚     â”‚ Test vs  â”‚     â”‚ Extract  â”‚â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ work     â”‚     â”‚ criteria â”‚     â”‚ insights â”‚       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
                           â”‚                              â”‚
                           â”‚ FAIL                         â”‚
                           â–¼                              â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
                    â”‚ Trace back   â”‚                     â”‚
                    â”‚ to failing   â”‚                     â”‚
                    â”‚ phase        â”‚                     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
                                                         â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚
    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                      MEMORY SYSTEM                                      â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
    â”‚  â”‚    HOT      â”‚  â”‚      WARM       â”‚  â”‚        COLD          â”‚        â”‚
    â”‚  â”‚  (CAPTURE)  â”‚  â”‚   (SYNTHESIS)   â”‚  â”‚   (APPLICATION)      â”‚        â”‚
    â”‚  â”‚             â”‚  â”‚                 â”‚  â”‚                      â”‚        â”‚
    â”‚  â”‚ Real-time   â”‚  â”‚ Learnings by    â”‚  â”‚ Immutable archive    â”‚        â”‚
    â”‚  â”‚ task traces â”‚  â”‚ algorithm phase â”‚  â”‚ Historical reference â”‚        â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### PAI Memory Structure

```
MEMORY/
â”œâ”€â”€ Learning/
â”‚   â”œâ”€â”€ OBSERVE/           # Context gathering improvements
â”‚   â”œâ”€â”€ THINK/             # Solution generation patterns
â”‚   â”œâ”€â”€ PLAN/              # Planning improvements
â”‚   â”œâ”€â”€ BUILD/             # Criteria definition learnings
â”‚   â”œâ”€â”€ EXECUTE/           # Execution optimizations
â”‚   â”œâ”€â”€ VERIFY/            # Verification improvements
â”‚   â”œâ”€â”€ LEARN/             # Meta-learnings
â”‚   â””â”€â”€ ALGORITHM/         # Algorithm self-improvements
â”‚
â”œâ”€â”€ Signals/
â”‚   â”œâ”€â”€ ratings/           # Explicit user ratings
â”‚   â”œâ”€â”€ sentiment/         # Implicit tone analysis
â”‚   â”œâ”€â”€ behavioral/        # Loopbacks, retries, abandons
â”‚   â””â”€â”€ verification/      # Objective pass/fail
â”‚
â””â”€â”€ Work/
    â”œâ”€â”€ active/            # Current task contexts
    â””â”€â”€ archive/           # Completed task records
```

### Hook System Events

```python
HOOKS = {
    "SessionStart":     "Initialize agent, load context",
    "SessionEnd":       "Persist state, cleanup",
    "UserPromptSubmit": "Capture input, route to supervisor",
    "Stop":             "Task completion, trigger VERIFY",
    "SubagentStop":     "Child agent completed, aggregate",
    "PreToolUse":       "Validate tool call, log intent",
    "PostToolUse":      "Capture result, update memory",
    "PreCompact":       "Context optimization checkpoint"
}
```

---

## SSH & Tmux Access

### Remote Access Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        SSH ACCESS ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Admin Workstation
          â”‚
          â”‚ SSH (Port 22, Key Auth)
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                         SERVER                                          â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚                    TMUX SESSION: ai-infrastructure                â”‚  â”‚
    â”‚  â”‚                                                                   â”‚  â”‚
    â”‚  â”‚  Window 0: supervisor    â”‚ Window 1: code     â”‚ Window 2: data   â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
    â”‚  â”‚  â”‚ $ claude            â”‚ â”‚ â”‚ $ claude        â”‚â”‚ â”‚ $ claude      â”‚â”‚  â”‚
    â”‚  â”‚  â”‚ [Supervisor Agent]  â”‚ â”‚ â”‚ [Code Agent]    â”‚â”‚ â”‚ [Data Agent]  â”‚â”‚  â”‚
    â”‚  â”‚  â”‚                     â”‚ â”‚ â”‚                 â”‚â”‚ â”‚               â”‚â”‚  â”‚
    â”‚  â”‚  â”‚ Listening on Redis  â”‚ â”‚ â”‚ Listening...    â”‚â”‚ â”‚ Listening...  â”‚â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
    â”‚  â”‚                          â”‚                    â”‚                   â”‚  â”‚
    â”‚  â”‚  Window 3: infra         â”‚ Window 4: research â”‚ Window 5: qa     â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
    â”‚  â”‚  â”‚ $ claude            â”‚ â”‚ â”‚ $ claude        â”‚â”‚ â”‚ $ claude      â”‚â”‚  â”‚
    â”‚  â”‚  â”‚ [Infra Agent]       â”‚ â”‚ â”‚ [Research Agent]â”‚â”‚ â”‚ [QA Agent]    â”‚â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
    â”‚  â”‚                                                                   â”‚  â”‚
    â”‚  â”‚  Window 6: monitor       â”‚ Window 7: logs                        â”‚  â”‚
    â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚  â”‚
    â”‚  â”‚  â”‚ $ htop / btop       â”‚ â”‚ â”‚ $ tail -f /var/log/ai-infra/*.log  â”‚â”‚  â”‚
    â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    COMMANDS:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€
    ssh root@server                           # Connect to server
    tmux attach -t ai-infrastructure          # Attach to agent session
    tmux select-window -t ai-infrastructure:0 # Switch to supervisor
    tmux select-window -t ai-infrastructure:1 # Switch to code agent
    Ctrl+b d                                  # Detach from session
    Ctrl+b n                                  # Next window
    Ctrl+b p                                  # Previous window
```

### SSH Security Configuration

```bash
# /etc/ssh/sshd_config additions
PermitRootLogin prohibit-password    # Key-only root access
PasswordAuthentication no            # No password auth
PubkeyAuthentication yes             # Key auth enabled
AllowUsers root admin                # Whitelist users
MaxAuthTries 3                       # Limit attempts
ClientAliveInterval 300              # Keep-alive
ClientAliveCountMax 2                # Disconnect on timeout
```

---

## Multi-Domain Management

### Domain Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MULTI-DOMAIN ARCHITECTURE                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              INTERNET
                                  â”‚
                                  â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚              NGINX                    â”‚
              â”‚         (Reverse Proxy)               â”‚
              â”‚                                       â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚     TLS TERMINATION             â”‚  â”‚
              â”‚  â”‚  - Let's Encrypt Certificates   â”‚  â”‚
              â”‚  â”‚  - Auto-renewal via Certbot     â”‚  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â”‚                                       â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
              â”‚  â”‚     VIRTUAL HOSTS               â”‚  â”‚
              â”‚  â”‚                                 â”‚  â”‚
              â”‚  â”‚  api.example.com    â†’ :8000     â”‚  â”‚
              â”‚  â”‚  portal.example.com â†’ :3000     â”‚  â”‚
              â”‚  â”‚  app1.example.com   â†’ /var/www/app1  â”‚
              â”‚  â”‚  app2.example.com   â†’ /var/www/app2  â”‚
              â”‚  â”‚  blog.example.com   â†’ /var/www/blog  â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚         â”‚         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼                     â–¼                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  /var/www/app1  â”‚  â”‚  /var/www/app2  â”‚  â”‚  /var/www/blog  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  index.html     â”‚  â”‚  index.html     â”‚  â”‚  index.html     â”‚
â”‚  assets/        â”‚  â”‚  assets/        â”‚  â”‚  posts/         â”‚
â”‚  .htaccess      â”‚  â”‚  api/           â”‚  â”‚  themes/        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Nginx Configuration Structure

```
/etc/nginx/
â”œâ”€â”€ nginx.conf                 # Main config
â”œâ”€â”€ sites-available/
â”‚   â”œâ”€â”€ default
â”‚   â”œâ”€â”€ api.example.com       # API server
â”‚   â”œâ”€â”€ portal.example.com    # Web portal
â”‚   â”œâ”€â”€ app1.example.com      # Static site 1
â”‚   â”œâ”€â”€ app2.example.com      # Static site 2
â”‚   â””â”€â”€ template.conf         # Template for new domains
â”œâ”€â”€ sites-enabled/            # Symlinks to active sites
â”œâ”€â”€ ssl/
â”‚   â””â”€â”€ dhparam.pem          # DH parameters
â”œâ”€â”€ snippets/
â”‚   â”œâ”€â”€ ssl-params.conf      # SSL settings
â”‚   â”œâ”€â”€ security-headers.conf # Security headers
â”‚   â””â”€â”€ proxy-params.conf    # Proxy settings
â””â”€â”€ conf.d/
    â”œâ”€â”€ rate-limiting.conf   # Rate limiting rules
    â””â”€â”€ gzip.conf            # Compression settings
```

### Infrastructure Agent Domain Commands

```python
# Commands the Infrastructure Agent can execute
DOMAIN_COMMANDS = {
    "add_domain": {
        "steps": [
            "Create /var/www/{domain}",
            "Create nginx config from template",
            "Enable site (symlink)",
            "Request SSL cert via certbot",
            "Reload nginx",
            "Verify domain accessible"
        ]
    },
    "remove_domain": {
        "steps": [
            "Disable site (remove symlink)",
            "Archive web root",
            "Remove nginx config",
            "Revoke SSL cert (optional)",
            "Reload nginx"
        ]
    },
    "update_ssl": {
        "steps": [
            "Run certbot renew",
            "Verify cert validity",
            "Reload nginx if renewed"
        ]
    },
    "deploy_site": {
        "steps": [
            "Pull/copy new files to web root",
            "Set permissions",
            "Clear cache if applicable",
            "Verify deployment"
        ]
    }
}
```

---

## Directory Structure

```
/home/user/AI-Infrastructure/
â”œâ”€â”€ README.md
â”œâ”€â”€ LICENSE (MIT)
â”œâ”€â”€ .env.example
â”œâ”€â”€ .gitignore
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ docker-compose.prod.yml
â”œâ”€â”€ Makefile
â”œâ”€â”€ install.sh                    # One-line installer
â”‚
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ architecture.md
â”‚   â”œâ”€â”€ deployment.md
â”‚   â”œâ”€â”€ agents.md
â”‚   â”œâ”€â”€ api.md
â”‚   â””â”€â”€ security.md
â”‚
â”œâ”€â”€ pai/                          # PAI Integration
â”‚   â”œâ”€â”€ .claude/                  # Claude configurations
â”‚   â”‚   â”œâ”€â”€ settings.json
â”‚   â”‚   â””â”€â”€ commands/
â”‚   â”œâ”€â”€ MEMORY/                   # PAI Memory System
â”‚   â”‚   â”œâ”€â”€ Learning/
â”‚   â”‚   â”‚   â”œâ”€â”€ OBSERVE/
â”‚   â”‚   â”‚   â”œâ”€â”€ THINK/
â”‚   â”‚   â”‚   â”œâ”€â”€ PLAN/
â”‚   â”‚   â”‚   â”œâ”€â”€ BUILD/
â”‚   â”‚   â”‚   â”œâ”€â”€ EXECUTE/
â”‚   â”‚   â”‚   â”œâ”€â”€ VERIFY/
â”‚   â”‚   â”‚   â”œâ”€â”€ LEARN/
â”‚   â”‚   â”‚   â””â”€â”€ ALGORITHM/
â”‚   â”‚   â”œâ”€â”€ Signals/
â”‚   â”‚   â”‚   â”œâ”€â”€ ratings/
â”‚   â”‚   â”‚   â”œâ”€â”€ sentiment/
â”‚   â”‚   â”‚   â”œâ”€â”€ behavioral/
â”‚   â”‚   â”‚   â””â”€â”€ verification/
â”‚   â”‚   â””â”€â”€ Work/
â”‚   â”‚       â”œâ”€â”€ active/
â”‚   â”‚       â””â”€â”€ archive/
â”‚   â”œâ”€â”€ TELOS/                    # Goal Configuration
â”‚   â”‚   â”œâ”€â”€ mission.md
â”‚   â”‚   â”œâ”€â”€ vision.md
â”‚   â”‚   â”œâ”€â”€ values.md
â”‚   â”‚   â”œâ”€â”€ priorities.md
â”‚   â”‚   â””â”€â”€ success.md
â”‚   â””â”€â”€ hooks/                    # Event Hooks
â”‚       â”œâ”€â”€ session_start.py
â”‚       â”œâ”€â”€ session_end.py
â”‚       â”œâ”€â”€ user_prompt.py
â”‚       â”œâ”€â”€ task_complete.py
â”‚       â””â”€â”€ tool_use.py
â”‚
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ core/                     # Shared utilities
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/ai_core/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ config.py
â”‚   â”‚       â”œâ”€â”€ logging.py
â”‚   â”‚       â””â”€â”€ exceptions.py
â”‚   â”‚
â”‚   â”œâ”€â”€ messaging/                # Redis messaging
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/ai_messaging/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ bus.py
â”‚   â”‚       â”œâ”€â”€ publisher.py
â”‚   â”‚       â”œâ”€â”€ subscriber.py
â”‚   â”‚       â”œâ”€â”€ streams.py
â”‚   â”‚       â””â”€â”€ protocols.py
â”‚   â”‚
â”‚   â”œâ”€â”€ memory/                   # Vector DB + PAI memory
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/ai_memory/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ embeddings.py     # OpenAI embeddings
â”‚   â”‚       â”œâ”€â”€ qdrant_store.py
â”‚   â”‚       â”œâ”€â”€ retriever.py
â”‚   â”‚       â”œâ”€â”€ pai_memory.py     # PAI integration
â”‚   â”‚       â””â”€â”€ schemas.py
â”‚   â”‚
â”‚   â””â”€â”€ tmux_manager/             # Tmux orchestration
â”‚       â”œâ”€â”€ pyproject.toml
â”‚       â””â”€â”€ src/ai_tmux/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ session.py
â”‚           â”œâ”€â”€ agent_runner.py
â”‚           â”œâ”€â”€ monitor.py
â”‚           â””â”€â”€ config.py
â”‚
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api/                      # FastAPI backend
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â””â”€â”€ src/api/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚       â”œâ”€â”€ config.py
â”‚   â”‚       â”œâ”€â”€ dependencies.py
â”‚   â”‚       â”œâ”€â”€ middleware/
â”‚   â”‚       â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚       â”‚   â”œâ”€â”€ rate_limit.py
â”‚   â”‚       â”‚   â””â”€â”€ logging.py
â”‚   â”‚       â”œâ”€â”€ routes/
â”‚   â”‚       â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚       â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚       â”‚   â”œâ”€â”€ agents.py
â”‚   â”‚       â”‚   â”œâ”€â”€ tasks.py
â”‚   â”‚       â”‚   â”œâ”€â”€ memory.py
â”‚   â”‚       â”‚   â”œâ”€â”€ domains.py    # Domain management
â”‚   â”‚       â”‚   â””â”€â”€ voice.py
â”‚   â”‚       â”œâ”€â”€ websocket/
â”‚   â”‚       â”‚   â”œâ”€â”€ manager.py
â”‚   â”‚       â”‚   â””â”€â”€ handlers.py
â”‚   â”‚       â””â”€â”€ services/
â”‚   â”‚           â”œâ”€â”€ auth_service.py
â”‚   â”‚           â”œâ”€â”€ chat_service.py
â”‚   â”‚           â”œâ”€â”€ agent_service.py
â”‚   â”‚           â””â”€â”€ domain_service.py
â”‚   â”‚
â”‚   â”œâ”€â”€ supervisor/               # Supervisor agent
â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â”œâ”€â”€ AGENT.md              # System prompt
â”‚   â”‚   â””â”€â”€ src/supervisor/
â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚       â”œâ”€â”€ orchestrator.py
â”‚   â”‚       â”œâ”€â”€ router.py
â”‚   â”‚       â”œâ”€â”€ aggregator.py
â”‚   â”‚       â”œâ”€â”€ algorithm.py      # PAI Algorithm
â”‚   â”‚       â””â”€â”€ prompts/
â”‚   â”‚
â”‚   â”œâ”€â”€ agents/
â”‚   â”‚   â”œâ”€â”€ base/                 # Base agent class
â”‚   â”‚   â”‚   â”œâ”€â”€ pyproject.toml
â”‚   â”‚   â”‚   â””â”€â”€ src/agent_base/
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ agent.py
â”‚   â”‚   â”‚       â”œâ”€â”€ tools.py
â”‚   â”‚   â”‚       â”œâ”€â”€ memory.py
â”‚   â”‚   â”‚       â””â”€â”€ communication.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ code_agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ AGENT.md
â”‚   â”‚   â”‚   â””â”€â”€ src/code_agent/
â”‚   â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚   â”‚       â””â”€â”€ tools/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ data_agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ AGENT.md
â”‚   â”‚   â”‚   â””â”€â”€ src/data_agent/
â”‚   â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚   â”‚       â””â”€â”€ tools/
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ infra_agent/          # Server/domain management
â”‚   â”‚   â”‚   â”œâ”€â”€ AGENT.md
â”‚   â”‚   â”‚   â””â”€â”€ src/infra_agent/
â”‚   â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚   â”‚       â””â”€â”€ tools/
â”‚   â”‚   â”‚           â”œâ”€â”€ nginx.py
â”‚   â”‚   â”‚           â”œâ”€â”€ certbot.py
â”‚   â”‚   â”‚           â”œâ”€â”€ docker.py
â”‚   â”‚   â”‚           â”œâ”€â”€ systemd.py
â”‚   â”‚   â”‚           â””â”€â”€ domains.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ research_agent/
â”‚   â”‚   â”‚   â”œâ”€â”€ AGENT.md
â”‚   â”‚   â”‚   â””â”€â”€ src/research_agent/
â”‚   â”‚   â”‚       â”œâ”€â”€ main.py
â”‚   â”‚   â”‚       â””â”€â”€ tools/
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ qa_agent/
â”‚   â”‚       â”œâ”€â”€ AGENT.md
â”‚   â”‚       â””â”€â”€ src/qa_agent/
â”‚   â”‚           â”œâ”€â”€ main.py
â”‚   â”‚           â””â”€â”€ tools/
â”‚   â”‚
â”‚   â””â”€â”€ voice/                    # Voice processing
â”‚       â”œâ”€â”€ pyproject.toml
â”‚       â””â”€â”€ src/voice_service/
â”‚           â”œâ”€â”€ __init__.py
â”‚           â”œâ”€â”€ main.py
â”‚           â”œâ”€â”€ transcription.py  # OpenAI Whisper
â”‚           â”œâ”€â”€ synthesis.py      # OpenAI TTS
â”‚           â””â”€â”€ streaming.py
â”‚
â”œâ”€â”€ web/                          # Next.js frontend
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ next.config.js
â”‚   â”œâ”€â”€ tailwind.config.js
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ app/
â”‚       â”‚   â”œâ”€â”€ layout.tsx
â”‚       â”‚   â”œâ”€â”€ page.tsx
â”‚       â”‚   â”œâ”€â”€ (auth)/
â”‚       â”‚   â”‚   â”œâ”€â”€ login/
â”‚       â”‚   â”‚   â””â”€â”€ register/
â”‚       â”‚   â””â”€â”€ (dashboard)/
â”‚       â”‚       â”œâ”€â”€ chat/
â”‚       â”‚       â”œâ”€â”€ agents/
â”‚       â”‚       â”œâ”€â”€ domains/      # Domain management UI
â”‚       â”‚       â”œâ”€â”€ memory/
â”‚       â”‚       â””â”€â”€ settings/
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ ui/               # shadcn/ui
â”‚       â”‚   â”œâ”€â”€ chat/
â”‚       â”‚   â”œâ”€â”€ agents/
â”‚       â”‚   â”œâ”€â”€ domains/
â”‚       â”‚   â””â”€â”€ voice/
â”‚       â”œâ”€â”€ hooks/
â”‚       â”œâ”€â”€ lib/
â”‚       â””â”€â”€ stores/
â”‚
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ migrations/
â”‚   â”œâ”€â”€ seeds/
â”‚   â””â”€â”€ models/
â”‚
â”œâ”€â”€ infrastructure/
â”‚   â”œâ”€â”€ docker/
â”‚   â”‚   â”œâ”€â”€ Dockerfile.api
â”‚   â”‚   â”œâ”€â”€ Dockerfile.agent
â”‚   â”‚   â”œâ”€â”€ Dockerfile.web
â”‚   â”‚   â””â”€â”€ Dockerfile.voice
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â”œâ”€â”€ nginx.conf
â”‚   â”‚   â”œâ”€â”€ sites-available/
â”‚   â”‚   â”‚   â””â”€â”€ template.conf
â”‚   â”‚   â””â”€â”€ snippets/
â”‚   â”œâ”€â”€ systemd/
â”‚   â”‚   â”œâ”€â”€ ai-infrastructure.service
â”‚   â”‚   â”œâ”€â”€ ai-api.service
â”‚   â”‚   â””â”€â”€ ai-agents.service
â”‚   â””â”€â”€ scripts/
â”‚       â”œâ”€â”€ setup.sh
â”‚       â”œâ”€â”€ start-agents.sh
â”‚       â”œâ”€â”€ add-domain.sh
â”‚       â””â”€â”€ backup.sh
â”‚
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ agents.yaml               # Agent definitions
â”‚   â”œâ”€â”€ domains.yaml              # Domain configurations
â”‚   â”œâ”€â”€ tmux/
â”‚   â”‚   â””â”€â”€ session.yaml          # tmuxp config
â”‚   â””â”€â”€ prompts/
â”‚       â”œâ”€â”€ supervisor.md
â”‚       â”œâ”€â”€ code_agent.md
â”‚       â”œâ”€â”€ data_agent.md
â”‚       â”œâ”€â”€ infra_agent.md
â”‚       â”œâ”€â”€ research_agent.md
â”‚       â””â”€â”€ qa_agent.md
â”‚
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ integration/
    â””â”€â”€ e2e/
```

---

## User Interface

### Web Portal Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           WEB PORTAL LAYOUT                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â”Œâ”€â”€â”€â”€â”€â”  AI Infrastructure                    [User] â–¼  [Settings]  [Logout]â”‚
â”‚  â”‚ â—‰â—‰â—‰ â”‚                                                                    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”˜                                                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             â”‚                                                               â”‚
â”‚   SIDEBAR   â”‚                    MAIN CONTENT                               â”‚
â”‚             â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ğŸ’¬ Chat â”‚ â”‚  â”‚                                                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚ [Supervisor] Today at 2:30 PM                   â”‚   â”‚ â”‚
â”‚  â”‚ğŸ¤– Agentsâ”‚ â”‚  â”‚  â”‚ I've analyzed your request. Here's my plan:    â”‚   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚ 1. Code Agent will implement the API            â”‚   â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚ 2. Data Agent will set up the database         â”‚   â”‚ â”‚
â”‚  â”‚ğŸŒ Domainâ”‚ â”‚  â”‚  â”‚ 3. QA Agent will write tests                   â”‚   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚ğŸ§  Memoryâ”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â”‚ [Code Agent] Working...                         â”‚   â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚  â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘ 60%                        â”‚   â”‚ â”‚
â”‚  â”‚âš™ï¸ Settingsâ”‚ â”‚  â”‚  â”‚ Currently implementing user authentication...   â”‚   â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚
â”‚             â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚             â”‚                                                               â”‚
â”‚  AGENTS     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚                                                         â”‚ â”‚
â”‚  â”‚â—‰ Super â”‚ â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â” â”Œâ”€â”€â”â”‚ â”‚
â”‚  â”‚â—‰ Code  â”‚ â”‚  â”‚  â”‚ Type your message...                     â”‚ â”‚ğŸ“â”‚ â”‚ğŸ¤â”‚â”‚ â”‚
â”‚  â”‚â—‰ Data  â”‚ â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”˜ â””â”€â”€â”˜â”‚ â”‚
â”‚  â”‚â—‰ Infra â”‚ â”‚  â”‚        [Attach Files]        [Voice Input]    [Send â¤] â”‚ â”‚
â”‚  â”‚â—‰ Researchâ”‚ â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”‚â—‰ QA    â”‚ â”‚                                                               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚                                                               â”‚
â”‚             â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PAGES:
â”€â”€â”€â”€â”€
/chat        - Main chat interface with supervisor
/agents      - Agent status, logs, controls
/domains     - Domain management (add/remove/deploy)
/memory      - Browse vector DB, view learnings
/settings    - API keys, preferences, TELOS config
```

### Chat Features

- **Text Input**: Markdown support, code blocks
- **File Upload**: Images, documents, code files
- **Voice Input**: Push-to-talk, continuous listening
- **Voice Output**: TTS for agent responses
- **Streaming**: Real-time response streaming
- **Agent Status**: Live indicator of which agents are working

---

## Security Architecture

### Permission Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         PERMISSION LEVELS                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LEVEL 0: RESTRICTED (Default)
â”œâ”€â”€ Read: /workspace only
â”œâ”€â”€ Write: None
â”œâ”€â”€ Network: None
â””â”€â”€ Execute: None

LEVEL 1: STANDARD (Code/Data/Research/QA Agents)
â”œâ”€â”€ Read: /workspace, /var/www (read-only)
â”œâ”€â”€ Write: /workspace
â”œâ”€â”€ Network: HTTPS to allowlist (github.com, pypi.org, npm.js)
â””â”€â”€ Execute: git, npm, pip, pytest, approved tools

LEVEL 2: ELEVATED (Infrastructure Agent)
â”œâ”€â”€ Read: /workspace, /var/www, /etc/nginx, system logs
â”œâ”€â”€ Write: /workspace, /var/www, /etc/nginx/sites-available
â”œâ”€â”€ Network: Full outbound HTTPS
â””â”€â”€ Execute: docker, nginx, certbot, systemctl (limited)

LEVEL 3: PRIVILEGED (Supervisor + Human Approval)
â”œâ”€â”€ Read: Full system
â”œâ”€â”€ Write: Full system (with audit)
â”œâ”€â”€ Network: Full
â””â”€â”€ Execute: All (with confirmation for destructive ops)

ESCALATION:
Agent requests elevated permission â†’ Supervisor evaluates â†’
Auto-approve (within policy) OR Human approval required
All actions logged to audit trail
```

### Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User    â”‚â”€â”€â”€â”€â–¶â”‚  Portal  â”‚â”€â”€â”€â”€â–¶â”‚   API    â”‚â”€â”€â”€â”€â–¶â”‚  Redis   â”‚
â”‚          â”‚     â”‚          â”‚     â”‚          â”‚     â”‚          â”‚
â”‚ 1. Login â”‚     â”‚ 2. OAuth/â”‚     â”‚ 3. Issue â”‚     â”‚ 4. Store â”‚
â”‚    form  â”‚     â”‚    Creds â”‚     â”‚    JWT   â”‚     â”‚  session â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                  â”‚ WebSocketâ”‚
                                  â”‚ Connect  â”‚
                                  â”‚ w/ JWT   â”‚
                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## External Service Integrations

### AWS Secrets Manager

All sensitive credentials are stored in AWS Secrets Manager for secure, centralized management.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AWS SECRETS MANAGER INTEGRATION                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    AWS Secrets Manager                         AI Infrastructure
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    ai-infrastructure/                         Application Startup
    â”œâ”€â”€ anthropic-api-key      â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚
    â”œâ”€â”€ openai-api-key         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚ Secrets loaded
    â”œâ”€â”€ postgres-credentials   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚ into memory
    â”œâ”€â”€ redis-password         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚ (not env files)
    â”œâ”€â”€ qdrant-api-key         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚
    â”œâ”€â”€ jwt-secret             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚
    â”œâ”€â”€ cloudflare-token       â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â”‚
    â””â”€â”€ github-pat             â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶    â–¼

    FEATURES:
    â”€â”€â”€â”€â”€â”€â”€â”€â”€
    â€¢ Automatic rotation support
    â€¢ IAM-based access control
    â€¢ Audit logging via CloudTrail
    â€¢ No secrets in code or .env files
    â€¢ Secrets cached locally for performance
```

**Secret Structure:**
```json
{
  "ai-infrastructure/anthropic-api-key": "sk-ant-...",
  "ai-infrastructure/openai-api-key": "sk-...",
  "ai-infrastructure/postgres": {
    "username": "ai_infra",
    "password": "...",
    "host": "localhost",
    "port": 5432,
    "database": "ai_infrastructure"
  },
  "ai-infrastructure/redis-password": "...",
  "ai-infrastructure/jwt-secret": "...",
  "ai-infrastructure/cloudflare-token": "...",
  "ai-infrastructure/github-pat": "ghp_..."
}
```

**Python Integration:**
```python
# packages/core/src/ai_core/secrets.py
import boto3
from functools import lru_cache

class SecretsManager:
    def __init__(self, region: str = "us-east-1", prefix: str = "ai-infrastructure/"):
        self.client = boto3.client("secretsmanager", region_name=region)
        self.prefix = prefix

    @lru_cache(maxsize=100)
    def get_secret(self, name: str) -> str:
        """Retrieve secret with caching."""
        response = self.client.get_secret_value(SecretId=f"{self.prefix}{name}")
        return response["SecretString"]

    def get_api_keys(self) -> dict:
        """Load all API keys at startup."""
        return {
            "anthropic": self.get_secret("anthropic-api-key"),
            "openai": self.get_secret("openai-api-key"),
            "cloudflare": self.get_secret("cloudflare-token"),
            "github": self.get_secret("github-pat"),
        }
```

### Cloudflare Integration (Paid Account)

Cloudflare provides DNS management, CDN, DDoS protection, SSL certificates, and advanced features with your paid account.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        CLOUDFLARE INTEGRATION                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              INTERNET
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚       CLOUDFLARE        â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   DNS MANAGEMENT  â”‚  â”‚
                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
                    â”‚  â”‚  A     â†’ Server IPâ”‚  â”‚
                    â”‚  â”‚  CNAME â†’ Aliases  â”‚  â”‚
                    â”‚  â”‚  MX    â†’ Mail     â”‚  â”‚
                    â”‚  â”‚  TXT   â†’ Verify   â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   CDN / CACHING   â”‚  â”‚
                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
                    â”‚  â”‚  Static assets    â”‚  â”‚
                    â”‚  â”‚  Edge locations   â”‚  â”‚
                    â”‚  â”‚  Compression      â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚  SECURITY LAYER   â”‚  â”‚
                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
                    â”‚  â”‚  DDoS protection  â”‚  â”‚
                    â”‚  â”‚  WAF rules        â”‚  â”‚
                    â”‚  â”‚  Bot management   â”‚  â”‚
                    â”‚  â”‚  Rate limiting    â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â”‚                         â”‚
                    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                    â”‚  â”‚   SSL/TLS         â”‚  â”‚
                    â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  â”‚
                    â”‚  â”‚  Free certificatesâ”‚  â”‚
                    â”‚  â”‚  Full (strict)    â”‚  â”‚
                    â”‚  â”‚  Auto-renewal     â”‚  â”‚
                    â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                 â”‚
                                 â–¼
                         YOUR SERVER
```

**Infrastructure Agent Cloudflare Tools:**
```python
# services/agents/infra_agent/src/infra_agent/tools/cloudflare.py
import httpx
from typing import Optional

class CloudflareTools:
    """Cloudflare API client using Global API Key (paid account)."""
    BASE_URL = "https://api.cloudflare.com/client/v4"

    def __init__(self, api_key: str, email: str, account_id: str):
        self.headers = {
            "X-Auth-Key": api_key,
            "X-Auth-Email": email,
            "Content-Type": "application/json"
        }
        self.account_id = account_id
        self._zones: dict[str, str] = {}  # domain -> zone_id mapping

    async def list_zones(self) -> list[dict]:
        """List all zones in the account."""
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{self.BASE_URL}/zones",
                headers=self.headers,
                params={"account.id": self.account_id}
            )
            data = response.json()
            for zone in data.get("result", []):
                self._zones[zone["name"]] = zone["id"]
            return data["result"]

    async def add_dns_record(self, zone_id: str, name: str, content: str,
                            type: str = "A", proxied: bool = True, ttl: int = 1):
        """Add a DNS record for a new domain."""
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.BASE_URL}/zones/{zone_id}/dns_records",
                headers=self.headers,
                json={
                    "type": type, "name": name, "content": content,
                    "proxied": proxied, "ttl": ttl
                }
            )
            return response.json()

    async def create_zone(self, domain: str) -> dict:
        """Add a new domain/zone to the account."""
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.BASE_URL}/zones",
                headers=self.headers,
                json={"name": domain, "account": {"id": self.account_id}}
            )
            return response.json()

    async def purge_cache(self, zone_id: str, files: list[str] = None):
        """Purge CDN cache for specific files or entire zone."""
        payload = {"purge_everything": True} if not files else {"files": files}
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.BASE_URL}/zones/{zone_id}/purge_cache",
                headers=self.headers,
                json=payload
            )
            return response.json()

    async def create_waf_rule(self, zone_id: str, expression: str,
                              action: str = "block", description: str = ""):
        """Create a WAF custom rule (paid feature)."""
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.BASE_URL}/zones/{zone_id}/rulesets/phases/http_request_firewall_custom/entrypoint",
                headers=self.headers,
                json={
                    "rules": [{
                        "expression": expression,
                        "action": action,
                        "description": description
                    }]
                }
            )
            return response.json()

    async def get_analytics(self, zone_id: str, since: str = "-1440"):
        """Get traffic analytics for the zone."""
        async with httpx.AsyncClient() as client:
            response = await client.get(
                f"{self.BASE_URL}/zones/{zone_id}/analytics/dashboard",
                headers=self.headers,
                params={"since": since}
            )
            return response.json()

    async def update_ssl_settings(self, zone_id: str, mode: str = "full"):
        """Update SSL/TLS encryption mode (off, flexible, full, strict)."""
        async with httpx.AsyncClient() as client:
            response = await client.patch(
                f"{self.BASE_URL}/zones/{zone_id}/settings/ssl",
                headers=self.headers,
                json={"value": mode}
            )
            return response.json()

    async def enable_always_https(self, zone_id: str, enabled: bool = True):
        """Enable Always Use HTTPS."""
        async with httpx.AsyncClient() as client:
            response = await client.patch(
                f"{self.BASE_URL}/zones/{zone_id}/settings/always_use_https",
                headers=self.headers,
                json={"value": "on" if enabled else "off"}
            )
            return response.json()
```

**Agent Commands via Cloudflare (Paid Features):**
- Create new zones/domains in account
- Add/remove DNS records (A, AAAA, CNAME, MX, TXT)
- Purge CDN cache after deployments
- Enable/disable proxying for maintenance
- Create WAF custom rules for security
- Configure SSL/TLS modes (Full Strict recommended)
- Enable Always HTTPS redirect
- Set up Page Rules for URL routing
- Monitor traffic analytics and threats
- Configure rate limiting rules
- Manage Workers (serverless functions)
- Set up Load Balancing (if subscribed)

### GitHub Integration

GitHub provides version control, backup, and collaboration through PAT (Personal Access Token).

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         GITHUB INTEGRATION                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    AI INFRASTRUCTURE                              GITHUB
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”€â”€â”€â”€â”€â”€â”€â”€

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   /workspace        â”‚   git push      â”‚  Main Repository    â”‚
    â”‚   (Active code)     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  AI-Infrastructure  â”‚
    â”‚                     â”‚                 â”‚                     â”‚
    â”‚   - Services        â”‚                 â”‚  - Full codebase    â”‚
    â”‚   - Packages        â”‚                 â”‚  - Agent prompts    â”‚
    â”‚   - Config          â”‚                 â”‚  - Configurations   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   PAI MEMORY        â”‚   Scheduled     â”‚  Backup Repository  â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚   Backup        â”‚  ai-infra-backup    â”‚
    â”‚                     â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                     â”‚
    â”‚   - Learning/       â”‚   (Daily)       â”‚  - Memory snapshots â”‚
    â”‚   - Signals/        â”‚                 â”‚  - Learning history â”‚
    â”‚   - Work/           â”‚                 â”‚  - Configuration    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   CONFIGURATIONS    â”‚   Sync          â”‚  Config Repository  â”‚
    â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  ai-infra-config    â”‚
    â”‚                     â”‚                 â”‚                     â”‚
    â”‚   - agents.yaml     â”‚                 â”‚  - Versioned config â”‚
    â”‚   - domains.yaml    â”‚                 â”‚  - Change tracking  â”‚
    â”‚   - TELOS/          â”‚                 â”‚  - Rollback support â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

USE CASES:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
1. CODE BACKUP:     Daily automated backup of all code changes
2. MEMORY BACKUP:   Weekly backup of PAI memory and learnings
3. CONFIG SYNC:     Bi-directional sync of configurations
4. AGENT PROMPTS:   Version control for agent system prompts
5. COLLABORATION:   Multiple users can contribute improvements
6. ROLLBACK:        Restore previous versions if issues occur
```

**GitHub Tools for Agents:**
```python
# packages/core/src/ai_core/github.py
import httpx
import base64
from datetime import datetime

class GitHubClient:
    BASE_URL = "https://api.github.com"

    def __init__(self, token: str, owner: str, repo: str):
        self.headers = {
            "Authorization": f"Bearer {token}",
            "Accept": "application/vnd.github.v3+json"
        }
        self.owner = owner
        self.repo = repo

    async def backup_file(self, path: str, content: str, message: str = None):
        """Backup a file to GitHub repository."""
        message = message or f"Backup: {path} at {datetime.utcnow().isoformat()}"
        encoded = base64.b64encode(content.encode()).decode()

        # Get current file SHA if exists (for update)
        sha = await self._get_file_sha(path)

        payload = {
            "message": message,
            "content": encoded,
            "branch": "main"
        }
        if sha:
            payload["sha"] = sha

        async with httpx.AsyncClient() as client:
            response = await client.put(
                f"{self.BASE_URL}/repos/{self.owner}/{self.repo}/contents/{path}",
                headers=self.headers,
                json=payload
            )
            return response.json()

    async def backup_memory(self, memory_dir: str):
        """Backup entire PAI memory directory."""
        # Tar and upload memory directory
        pass

    async def create_release(self, tag: str, name: str, body: str):
        """Create a release for version tracking."""
        async with httpx.AsyncClient() as client:
            response = await client.post(
                f"{self.BASE_URL}/repos/{self.owner}/{self.repo}/releases",
                headers=self.headers,
                json={"tag_name": tag, "name": name, "body": body}
            )
            return response.json()

    async def sync_config(self, local_path: str, remote_path: str):
        """Bi-directional sync of configuration files."""
        pass
```

**Automated Backup Schedule:**
```yaml
# config/backup.yaml
schedules:
  code_backup:
    cron: "0 2 * * *"        # Daily at 2 AM
    type: full
    target: AI-Infrastructure

  memory_backup:
    cron: "0 3 * * 0"        # Weekly on Sunday at 3 AM
    type: incremental
    target: ai-infra-backup
    paths:
      - pai/MEMORY/Learning
      - pai/MEMORY/Signals

  config_sync:
    cron: "*/30 * * * *"     # Every 30 minutes
    type: bidirectional
    target: ai-infra-config
    paths:
      - config/agents.yaml
      - config/domains.yaml
      - pai/TELOS/
```

---

## Implementation Phases

### Phase 1: Foundation (Week 1-2)
- [ ] Project setup, Docker Compose (Redis, Qdrant, PostgreSQL)
- [ ] Core packages: config, logging, messaging
- [ ] Memory package with OpenAI embeddings + Qdrant
- [ ] PAI memory structure setup
- [ ] Basic tmux manager

### Phase 2: Agent Framework (Week 3-4)
- [ ] Base agent class with Claude integration
- [ ] Supervisor agent with routing logic
- [ ] First domain agent (code_agent)
- [ ] Inter-agent communication via Redis
- [ ] PAI Algorithm integration

### Phase 3: Multi-Agent System (Week 5-6)
- [ ] Remaining agents (data, infra, research, qa)
- [ ] Agent health monitoring
- [ ] Task orchestration patterns
- [ ] PAI hook system
- [ ] Learning signal capture

### Phase 4: Infrastructure Agent (Week 7)
- [ ] Nginx configuration tools
- [ ] Domain management (add/remove)
- [ ] SSL/Certbot integration
- [ ] Docker management tools
- [ ] SSH access setup

### Phase 5: API & Backend (Week 8-9)
- [ ] FastAPI application setup
- [ ] Authentication (JWT + OAuth)
- [ ] WebSocket real-time chat
- [ ] File upload handling
- [ ] Domain management API

### Phase 6: Web Portal (Week 10-11)
- [ ] Next.js setup with shadcn/ui
- [ ] Authentication pages
- [ ] Chat interface with streaming
- [ ] Agent dashboard
- [ ] Domain management UI

### Phase 7: Voice & Polish (Week 12)
- [ ] OpenAI Whisper integration (STT)
- [ ] OpenAI TTS integration
- [ ] Voice UI components
- [ ] Installer script
- [ ] Documentation

---

## Environment Variables

```bash
# .env.example

# === PAID API SERVICES ===
ANTHROPIC_API_KEY=sk-ant-...           # Claude API
OPENAI_API_KEY=sk-...                   # Embeddings, Whisper, TTS

# === AWS SECRETS MANAGER ===
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=AKIA...
AWS_SECRET_ACCESS_KEY=...
AWS_SECRETS_PREFIX=ai-infrastructure/  # Prefix for all secrets

# === CLOUDFLARE (Paid Account) ===
CLOUDFLARE_API_KEY=...                 # Global API Key (Account Settings)
CLOUDFLARE_EMAIL=your@email.com        # Account email
CLOUDFLARE_ACCOUNT_ID=...              # Account ID
CLOUDFLARE_ZONE_IDS=zone1,zone2,...    # Comma-separated Zone IDs for managed domains

# === GITHUB ===
GITHUB_PAT=ghp_...                     # Personal Access Token
GITHUB_OWNER=your-username             # GitHub username or org
GITHUB_REPO=ai-infrastructure-backup   # Backup repository
GITHUB_BRANCH=main                     # Branch for backups

# === FREE INFRASTRUCTURE ===
# PostgreSQL
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=ai_infra
POSTGRES_PASSWORD=<from-aws-secrets>
POSTGRES_DB=ai_infrastructure

# Redis
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=<from-aws-secrets>

# Qdrant
QDRANT_HOST=localhost
QDRANT_PORT=6333
QDRANT_API_KEY=<from-aws-secrets>

# === APPLICATION ===
JWT_SECRET=<from-aws-secrets>
JWT_ALGORITHM=HS256
JWT_EXPIRY_HOURS=24

# === DOMAINS ===
PRIMARY_DOMAIN=portal.example.com
API_DOMAIN=api.example.com
WEBROOT_BASE=/var/www

# === SSH ===
SSH_PORT=22
SSH_ALLOWED_USERS=root,admin
```

---

## Quick Start (After Implementation)

```bash
# One-line install
curl -fsSL https://raw.githubusercontent.com/user/AI-Infrastructure/main/install.sh | bash

# Or manual setup
git clone https://github.com/user/AI-Infrastructure.git
cd AI-Infrastructure
cp .env.example .env
# Edit .env with your API keys

# Start infrastructure
docker-compose up -d

# Start agents
./scripts/start-agents.sh

# Access
# Web Portal: https://portal.your-domain.com
# SSH: ssh root@your-server then `tmux attach -t ai-infrastructure`
```

---

## Next Steps

1. **Review this plan** - Does this architecture meet your needs?
2. **Clarify requirements** - Any specific features to add/remove?
3. **Begin implementation** - Start with Phase 1 foundation

Ready to proceed when you approve this plan.
